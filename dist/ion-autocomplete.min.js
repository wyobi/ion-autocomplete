/*
 * ion-autocomplete 0.2.2
 * Copyright 2015 Danny Povolotski 
 * Copyright modifications 2015 Guy Brand 
 * https://github.com/guylabs/ion-autocomplete
 */
!function(){"use strict";angular.module("ion-autocomplete",[]).directive("ionAutocomplete",["$ionicTemplateLoader","$ionicBackdrop","$ionicScrollDelegate","$rootScope","$document","$q","$parse","$ionicPlatform",function(a,b,c,d,e,f,g,h){return{require:"?ngModel",restrict:"A",scope:{model:"=ngModel",placeholder:"@",cancelLabel:"@",selectItemsLabel:"@",selectedItemsLabel:"@",templateUrl:"@",templateData:"=",itemsMethod:"&",itemsMethodValueKey:"@",itemValueKey:"@",itemViewValueKey:"@",multipleSelect:"@",itemsClickedMethod:"&",itemsRemovedMethod:"&",componentId:"@",modelToItemMethod:"&"},link:function(d,i,j,k){if(k){d.placeholder=d.placeholder?d.placeholder:"Click to enter a value...",d.cancelLabel=d.cancelLabel?d.cancelLabel:"true"===d.multipleSelect?"Done":"Cancel",d.selectItemsLabel=d.selectItemsLabel?d.selectItemsLabel:"Select an item...",d.selectedItemsLabel=d.selectedItemsLabel?d.selectedItemsLabel:"Selected items:",d.templateUrl=d.templateUrl?d.templateUrl:"",d.items=[],d.selectedItems=[],d.searchQuery="",d.getItemValue=function(a,b){if(angular.isArray(a)){var c=[];return angular.forEach(a,function(d){b&&angular.isObject(a)?c.push(g(b)(d)):c.push(d)}),c}return b&&angular.isObject(a)?g(b)(a):a};var l=['<div class="ion-autocomplete-container modal">','<div class="bar bar-header item-input-inset">','<label class="item-input-wrapper">','<i class="icon ion-search placeholder-icon"></i>','<input type="search" class="ion-autocomplete-search" ng-model="searchQuery" placeholder="{{placeholder}}"/>',"</label>",'<button class="ion-autocomplete-cancel button button-clear">{{cancelLabel}}</button>',"</div>",'<ion-content class="has-header has-header">',"<ion-list>",'<ion-item class="item-divider" ng-show="selectedItems.length > 0">{{selectedItemsLabel}}</ion-item>','<ion-item ng-repeat="selectedItem in selectedItems" type="item-text-wrap" class="item-icon-left item-icon-right">','<i class="icon ion-checkmark"></i>',"{{getItemValue(selectedItem, itemViewValueKey)}}",'<i class="icon ion-trash-a" style="cursor:pointer" ng-click="removeItem($index)"></i>',"</ion-item>",'<ion-item class="item-divider" ng-show="items.length > 0">{{selectItemsLabel}}</ion-item>','<ion-item collection-repeat="item in items" item-height="55" item-width="100%" type="item-text-wrap" ng-click="selectItem(item)">',"{{getItemValue(item, itemViewValueKey)}}","</ion-item>","</ion-list>","</ion-content>","</div>"].join("");a.compile({templateUrl:d.templateUrl,template:l,scope:d,appendTo:e[0].body}).then(function(a){var e=angular.element(a.element.find("input"));a.scope.selectItem=function(b){a.scope.items=[],a.scope.searchQuery="","true"===a.scope.multipleSelect?(q(a.scope.selectedItems,a.scope.itemValueKey,d.getItemValue(b,d.itemValueKey))||(a.scope.selectedItems=a.scope.selectedItems.concat([b])),k.$setViewValue(a.scope.selectedItems),k.$render()):(k.$setViewValue(b),k.$render(),l()),angular.isFunction(a.scope.itemsClickedMethod)&&a.scope.itemsClickedMethod({callback:{item:b,selectedItems:a.scope.selectedItems.slice(),componentId:a.scope.componentId}})},a.scope.removeItem=function(b){var c=a.scope.selectedItems.splice(b,1)[0];a.scope.selectedItems=a.scope.selectedItems.slice(),k.$setViewValue(a.scope.selectedItems),k.$render(),angular.isFunction(a.scope.itemsRemovedMethod)&&a.scope.itemsRemovedMethod({callback:{item:c,selectedItems:a.scope.selectedItems.slice(),componentId:a.scope.componentId}})};var g=function(b){if(""==b&&(a.scope.items=[]),angular.isFunction(a.scope.itemsMethod)){var d={query:b};a.scope.componentId&&(d={query:b,componentId:a.scope.componentId});var e=f.when(a.scope.itemsMethod(d));e.then(function(b){b&&b.data&&(b=b.data),a.scope.items=a.scope.getItemValue(b,a.scope.itemsMethodValueKey),c.resize()},function(a){return f.reject(a)})}};a.scope.$watch("searchQuery",g);var j=function(){b.retain(),a.element.css("display","block"),d.$deregisterBackButton=h.registerBackButtonAction(function(){l()},300)},l=function(){a.element.css("display","none"),b.release(),d.$deregisterBackButton&&d.$deregisterBackButton()},m={moved:!1,startX:0,startY:0},n=function(a){m.moved=!1,"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),m.startX=a.touches[0].clientX,m.startY=a.touches[0].clientY},o=function(a){"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),(Math.abs(a.touches[0].clientX-m.startX)>10||Math.abs(a.touches[0].clientY-m.startY)>10)&&(m.moved=!0)},p=function(a){m.moved||(a.preventDefault(),a.stopPropagation(),j(),e.length>0&&(e[0].focus(),setTimeout(function(){e[0].focus()},0)),g())},q=function(a,b,c){for(var e=0;e<a.length;e++)if(d.getItemValue(a[e],b)===c)return!0;return!1},r=function(b){var c=f.when(a.scope.modelToItemMethod({modelValue:b}));c.then(function(b){a.scope.selectItem(b)},function(a){return f.reject(a)})};i.bind("touchstart",n),i.bind("touchmove",o),i.bind("touchend",p),i.bind("click",p),a.element.find("button").bind("click",function(b){a.scope.searchQuery="",l()}),a.scope.model&&angular.isFunction(a.scope.modelToItemMethod)&&("true"===a.scope.multipleSelect&&angular.isArray(a.scope.model)?angular.forEach(a.scope.model,function(a){r(a)}):r(a.scope.model))}),k.$render=function(){i.val(d.getItemValue(k.$viewValue,d.itemViewValueKey))},k.$formatters.push(function(a){var b=d.getItemValue(a,d.itemViewValueKey);return void 0==b?"":b}),k.$parsers.push(function(a){return d.getItemValue(a,d.itemValueKey)})}}}}]).directive("ionAutocomplete",function(){return{require:"?ngModel",restrict:"E",template:'<input ion-autocomplete type="text" readonly="readonly" class="ion-autocomplete" autocomplete="off" />',replace:!0}})}();